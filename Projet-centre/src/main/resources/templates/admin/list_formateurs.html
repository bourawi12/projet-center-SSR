<!DOCTYPE html>
<html>
<head>
    <title>Manage Formateurs</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2>Manage Formateurs</h2>
    <p><a href="/welcome.html">Back to Dashboard</a></p>
    <p><a href="/admin/formateurs/new" class="btn btn-success">Add New Formateur</a></p>

    <div id="message" class="mt-3"></div>

    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Pr√©nom</th>
                <th>Email</th>
                <th>Speciality</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="formateurTableBody">
            <!-- Rows will be inserted here by JavaScript -->
        </tbody>
    </table>
</div>

<script>
async function loadFormateurs() {
    try {
        const response = await fetch('/formateurs/', {
            method: 'GET',
            credentials: 'include'
        });

        if (!response.ok) {
            document.getElementById('message').innerHTML = 
                '<div class="alert alert-danger">Failed to load formateurs.</div>';
            return;
        }

        const formateurs = await response.json();
        const tbody = document.getElementById('formateurTableBody');
        tbody.innerHTML = '';

        if (formateurs.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="text-center">No formateurs found.</td></tr>';
            return;
        }

        formateurs.forEach(formateur => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${formateur.id}</td>
                <td>${formateur.nom}</td>
                <td>${formateur.prenom}</td>
                <td>${formateur.email}</td>
                <td>${formateur.specialite}</td>
                <td>
                    <a href="/admin/formateurs/edit/${formateur.id}" class="btn btn-sm btn-primary">Edit</a>
                    <button class="btn btn-sm btn-danger" onclick="deleteFormateur(${formateur.id})">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });

    } catch (error) {
        console.error('Error loading formateurs:', error);
        document.getElementById('message').innerHTML = 
            '<div class="alert alert-danger">Network error loading formateurs.</div>';
    }
}

async function deleteFormateur(id) {
    if (!confirm('Are you sure you want to delete this formateur?')) {
        return;
    }

    try {
        const response = await fetch(`/formateurs/${id}`, {
            method: 'DELETE',
            credentials: 'include'
        });

        const messageDiv = document.getElementById('message');
        
        if (response.ok) {
            messageDiv.innerHTML = '<div class="alert alert-success">Formateur deleted successfully!</div>';
            loadFormateurs(); // Reload the list
        } else {
            const errorText = await response.text();
            messageDiv.innerHTML = `<div class="alert alert-danger">Delete failed: ${errorText}</div>`;
        }
    } catch (error) {
        console.error('Delete error:', error);
        document.getElementById('message').innerHTML = 
            '<div class="alert alert-danger">Network error during deletion.</div>';
    }
}

// Load formateurs when page loads
document.addEventListener('DOMContentLoaded', loadFormateurs);
</script>

</body>
</html>